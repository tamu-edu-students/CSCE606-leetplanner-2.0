<div class="app-container">
    <%= render 'shared/navbar' %>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Lobbies Page -->
        <div id="lobbiesPage" class="page">
            <div class="page-header align">
                <div>
                    <h1 class="page-title"><%= lobby.name ? lobby.name : 'UNNAMED LOBBY'%></h1>
                    <p class="page-subtitle"> Host: <%= User.find_by(id: lobby.owner_id).full_name %> </p>
                </div>
            </div>
            
            <div class="content-area">
                <!-- Three Column Layout -->
                <div class="lobby-layout">
                    <!-- Left Column: Shared Notes -->
                    <div class="lobby-section">
                        <h3 class="section-title">Shared Notes</h3>
                        <div class="notes-area">
                            <textarea placeholder="Take shared notes here..." rows="10"></textarea>
                        </div>
                    </div>

                    <!-- Center Column: Shared Whiteboard -->
                    <div class="lobby-section whiteboard-section">
                        <h3 class="section-title">Shared Whiteboard</h3>
                        <div class="whiteboard-container">
                            <!-- SVG Display Area -->
                            <div class="whiteboard-canvas-area">
                                <% if lobby.whiteboard&.svg_data.present? %>
                                    <%= lobby.whiteboard.svg_data.html_safe %>
                                <% else %>
                                    <svg width="100%" height="350" viewBox="0 0 800 350" xmlns="http://www.w3.org/2000/svg" class="whiteboard-svg">
                                        <defs>
                                            <pattern id="grid" width="20" height="20" patternUnits="userSpaceOnUse">
                                                <path d="M 20 0 L 0 0 0 20" fill="none" stroke="#333" stroke-width="0.5" opacity="0.3"/>
                                            </pattern>
                                        </defs>
                                        <rect width="100%" height="100%" fill="url(#grid)"/>
                                        <text x="400" y="175" text-anchor="middle" fill="#666" font-family="Arial" font-size="18" opacity="0.7">
                                            ‚úèÔ∏è Start collaborating - Add shapes below
                                        </text>
                                    </svg>
                                <% end %>
                            </div>
                            
                            <!-- Quick Action Tools -->
                            <div class="whiteboard-quick-tools">
                                <div class="quick-shapes">
                                    <%= form_with url: add_drawing_lobby_whiteboards_path(lobby), method: :post, local: true, class: "inline-form" do |f| %>
                                        <%= f.hidden_field :tool, value: "rectangle" %>
                                        <%= f.hidden_field :x, value: rand(100..600) %>
                                        <%= f.hidden_field :y, value: rand(50..200) %>
                                        <%= f.hidden_field :width, value: 120 %>
                                        <%= f.hidden_field :height, value: 80 %>
                                        <%= f.hidden_field :color, value: "#ffffff" %>
                                        <%= f.submit "‚ûï Add Rectangle", class: "btn btn-primary quick-btn" %>
                                    <% end %>
                                    
                                    <%= form_with url: add_drawing_lobby_whiteboards_path(lobby), method: :post, local: true, class: "inline-form" do |f| %>
                                        <%= f.hidden_field :tool, value: "circle" %>
                                        <%= f.hidden_field :x, value: rand(150..650) %>
                                        <%= f.hidden_field :y, value: rand(100..250) %>
                                        <%= f.hidden_field :radius, value: 60 %>
                                        <%= f.hidden_field :color, value: "#00ff00" %>
                                        <%= f.submit "‚≠ï Add Circle", class: "btn btn-primary quick-btn" %>
                                    <% end %>
                                    
                                    <%= form_with url: add_drawing_lobby_whiteboards_path(lobby), method: :post, local: true, class: "inline-form" do |f| %>
                                        <%= f.hidden_field :tool, value: "text" %>
                                        <%= f.hidden_field :x, value: rand(200..600) %>
                                        <%= f.hidden_field :y, value: rand(100..250) %>
                                        <%= f.hidden_field :text, value: "New Idea!" %>
                                        <%= f.hidden_field :color, value: "#ffff00" %>
                                        <%= f.submit "üìù Add Note", class: "btn btn-primary quick-btn" %>
                                    <% end %>
                                </div>
                                
                                <div class="whiteboard-controls">
                                    <%= form_with url: clear_lobby_whiteboards_path(lobby), method: :post, local: true, class: "inline-form" do |f| %>
                                        <%= f.submit "üóëÔ∏è Clear All", class: "btn btn-danger", 
                                            data: { confirm: "Clear the entire whiteboard?" } %>
                                    <% end %>
                                </div>
                            </div>
                            
                            <!-- Advanced Tools (Collapsible) -->
                            <details class="advanced-tools">
                                <summary class="tools-toggle">üõ†Ô∏è Advanced Drawing Tools</summary>
                                <div class="tools-grid">
                                    <div class="tool-group">
                                        <h4>üìê Custom Rectangle</h4>
                                        <%= form_with url: add_drawing_lobby_whiteboards_path(lobby), method: :post, local: true, class: "tool-form" do |f| %>
                                            <%= f.hidden_field :tool, value: "rectangle" %>
                                            <div class="form-row">
                                                <%= f.label :x, "X Position:" %>
                                                <%= f.number_field :x, value: 100, min: 0, max: 700, class: "form-input" %>
                                            </div>
                                            <div class="form-row">
                                                <%= f.label :y, "Y Position:" %>
                                                <%= f.number_field :y, value: 100, min: 0, max: 300, class: "form-input" %>
                                            </div>
                                            <div class="form-row">
                                                <%= f.label :width, "Width:" %>
                                                <%= f.number_field :width, value: 100, min: 10, max: 400, class: "form-input" %>
                                            </div>
                                            <div class="form-row">
                                                <%= f.label :height, "Height:" %>
                                                <%= f.number_field :height, value: 60, min: 10, max: 200, class: "form-input" %>
                                            </div>
                                            <div class="form-row">
                                                <%= f.label :color, "Color:" %>
                                                <%= f.select :color, options_for_select([
                                                      ['White', '#ffffff'], ['Red', '#ff4444'], ['Green', '#44ff44'], 
                                                      ['Blue', '#4444ff'], ['Yellow', '#ffff44'], ['Orange', '#ff8844'],
                                                      ['Purple', '#8844ff'], ['Cyan', '#44ffff']
                                                    ], '#ffffff'), {}, { class: "form-select" } %>
                                            </div>
                                            <%= f.submit "Create Rectangle", class: "btn btn-secondary" %>
                                        <% end %>
                                    </div>
                                    
                                    <div class="tool-group">
                                        <h4>‚≠ï Custom Circle</h4>
                                        <%= form_with url: add_drawing_lobby_whiteboards_path(lobby), method: :post, local: true, class: "tool-form" do |f| %>
                                            <%= f.hidden_field :tool, value: "circle" %>
                                            <div class="form-row">
                                                <%= f.label :x, "Center X:" %>
                                                <%= f.number_field :x, value: 200, min: 50, max: 750, class: "form-input" %>
                                            </div>
                                            <div class="form-row">
                                                <%= f.label :y, "Center Y:" %>
                                                <%= f.number_field :y, value: 175, min: 50, max: 300, class: "form-input" %>
                                            </div>
                                            <div class="form-row">
                                                <%= f.label :radius, "Radius:" %>
                                                <%= f.number_field :radius, value: 50, min: 10, max: 150, class: "form-input" %>
                                            </div>
                                            <div class="form-row">
                                                <%= f.label :color, "Color:" %>
                                                <%= f.select :color, options_for_select([
                                                      ['White', '#ffffff'], ['Red', '#ff4444'], ['Green', '#44ff44'], 
                                                      ['Blue', '#4444ff'], ['Yellow', '#ffff44'], ['Orange', '#ff8844'],
                                                      ['Purple', '#8844ff'], ['Cyan', '#44ffff']
                                                    ], '#44ff44'), {}, { class: "form-select" } %>
                                            </div>
                                            <%= f.submit "Create Circle", class: "btn btn-secondary" %>
                                        <% end %>
                                    </div>
                                    
                                    <div class="tool-group">
                                        <h4>üìù Custom Text</h4>
                                        <%= form_with url: add_drawing_lobby_whiteboards_path(lobby), method: :post, local: true, class: "tool-form" do |f| %>
                                            <%= f.hidden_field :tool, value: "text" %>
                                            <div class="form-row">
                                                <%= f.label :x, "X Position:" %>
                                                <%= f.number_field :x, value: 300, min: 10, max: 780, class: "form-input" %>
                                            </div>
                                            <div class="form-row">
                                                <%= f.label :y, "Y Position:" %>
                                                <%= f.number_field :y, value: 150, min: 20, max: 330, class: "form-input" %>
                                            </div>
                                            <div class="form-row">
                                                <%= f.label :text, "Text:" %>
                                                <%= f.text_field :text, placeholder: "Enter your text...", class: "form-input", required: true %>
                                            </div>
                                            <div class="form-row">
                                                <%= f.label :color, "Color:" %>
                                                <%= f.select :color, options_for_select([
                                                      ['White', '#ffffff'], ['Red', '#ff4444'], ['Green', '#44ff44'], 
                                                      ['Blue', '#4444ff'], ['Yellow', '#ffff44'], ['Orange', '#ff8844'],
                                                      ['Purple', '#8844ff'], ['Cyan', '#44ffff']
                                                    ], '#ffff44'), {}, { class: "form-select" } %>
                                            </div>
                                            <%= f.submit "Add Text", class: "btn btn-secondary" %>
                                        <% end %>
                                    </div>
                                </div>
                            </details>
                        </div>
                    </div>

                    <!-- Right Column: Participants, Voice Chat, Analytics -->
                    <div class="lobby-section">
                        <h3 class="section-title">Participants (<%= lobby.lobby_members.length%>)</h3>
                        <div class="participants-list">
                            <% if lobby.lobby_members.length >= 1%>
                                <ul class="lobby-members">
                                <% lobby.lobby_members.each do |member| %>
                                <li class="participant-item">
                                    <div class="participant-avatar">
                                        <%= User.find_by(id: member.user_id).first_name.first.upcase %>
                                    </div>
                                    <span class="participant-name"><%= User.find_by(id: member.user_id).full_name %></span>
                                    <div class="participant-status">
                                        <span class="status-dot online" title="Online"></span>
                                    </div>
                                </li>
                                <% end %>
                                </ul>
                            <% end %>
                        </div>

                        <!-- Voice Chat Section -->
                        <div class="voice-chat-section">
                            <h4 class="section-title">Voice Chat</h4>
                            <div class="voice-controls">
                                <button class="voice-btn" id="mute-btn">üé§ Mute</button>
                                <button class="voice-btn" id="leave-btn">üìû Leave</button>
                            </div>
                        </div>

                        <!-- Lobby Analytics -->
                        <div class="lobby-analytics">
                            <h4 class="section-title">Lobby Analytics</h4>
                            <div class="analytics-item">
                                <span>Session Duration:</span>
                                <span class="analytics-value">1h 30m</span>
                            </div>
                            <div class="analytics-item">
                                <span>Active Users:</span>
                                <span class="analytics-value"><%= lobby.lobby_members.length%>/5</span>
                            </div>
                            <div class="analytics-item">
                                <span>Problems Solved:</span>
                                <span class="analytics-value">0</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Description Section -->
                <div class="lobby-details">
                    <h3 class="section-title">Description</h3>
                    <div class="lobby-description"><%= lobby.description %></div>
                    
                    <% if current_user.id == @lobby.owner_id%>
                        <div class="lobby-actions">
                            <%= button_to "Destroy this lobby", @lobby, method: :delete, class: "btn btn-primary" %>
                        </div>
                    <% end %>
                </div>
            </div>
        </div>
    </main>
</div>
