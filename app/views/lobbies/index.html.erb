<div class="app-container">
    <%= render 'shared/navbar' %>

    <main class="main-content">
        <div id="lobbiesPage" class="page">
            <div class="page-header align">
                <div>
                    <h1 class="page-title">Collaborative Lobbies</h1>
                    <p class="page-subtitle">Connect and code together</p>
                </div>
            </div>

            <div class="content-area">
                <div class="join-lobby-form">
                    <h3 class="page-title">Join a Lobby</h3>
                    <%= form_with(url: join_lobby_path, method: :post, class: "join-form-fields") do |form| %>
                        <%= form.text_field :lobby_code, placeholder: "Enter Lobby Code", class: "focus-time-input", required: true %>
                        <%= form.submit "Join", class: "btn btn-primary" %>
                    <% end %>
                </div>

                <hr> <h3 class="page-title">Your Lobbies</h3>
                <div class="lobbies-grid" style="display: grid !important; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)) !important; gap: 24px !important; margin: 24px 0;">
                    <% @lobbies.each do |lobby| %>
                        <div class="lobby-card" style="background: #f8f9ff; border-radius: 12px; padding: 1.5rem; box-shadow: 0 4px 12px rgba(0,0,0,0.08); display: flex; flex-direction: column; text-decoration: none; color: inherit; border: 1px solid #e5e7eb; transition: transform 0.2s ease, box-shadow 0.2s ease;">
                            <%= link_to lobby_path(lobby), class: 'lobby-card-link' do %>
                                <div class="card-title" style="font-weight: 600; font-size: 1.25rem; margin-bottom: 0.25rem; color: #1d1d1f;"><%= lobby.name.presence || 'UNNAMED LOBBY' %></div>
                                <div class="card-subtitle" style="font-size: 0.95rem; color: #86868b; margin-bottom: 1.5rem;">Host: <%= lobby.owner.full_name %></div>
                            <% end %>
                            
                            <%# Display the invite code directly if the current user is the owner %>
                            <% if lobby.owner_id == current_user.id %>
                                <div class="card-invite-code" style="margin-top: auto; padding-top: 1rem; border-top: 1px solid #e5e7eb; font-size: 0.9rem; color: #6b6b70;">
                                    <strong>Invite Code:</strong> <span style="font-weight: bold; font-family: 'SF Mono', Monaco, monospace; color: var(--tamu-red); background-color: #f5f5f7; padding: 0.25rem 0.5rem; border-radius: 4px; letter-spacing: 1px;"><%= lobby.lobby_code %></span>
                                </div>
                            <% end %>
                        </div>
                    <% end %>
                </div>

                <hr>
                <br/>
                <%= link_to "+ Create New Lobby", new_lobby_path(), class: "btn btn-primary" %>
            </div>
        </div>
    </main>
</div>