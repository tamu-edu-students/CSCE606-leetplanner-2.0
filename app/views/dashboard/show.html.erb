<div class="app-container">
    <%= render 'shared/navbar' %>

    <!-- Main Content -->
    <main class="main-content">
      <!-- Dashboard Page -->
      <div id="dashboardPage" class="page">
        <div class="page-header">
          <h1 class="page-title user-name">Dashboard</h1>
          <p class="page-subtitle">Track your time and stay productive</p>
        </div>
        
        <div class="content-area">
          <div class="timer-container" data-controller="timer" 
               data-timer-initial-time-hms-value="<%= @time_remaining_hms || '00:00:00' %>"
               data-timer-start-on-load-value="<%= @current_event.present?.to_s %>">

          <% if @current_event.present? %>
            <div class="event-banner">
              <h2 class="event-title">Now: <%= @current_event.summary.presence || "Current Event" %></h2>
              <p class="event-time">
                <% if @current_event.start.respond_to?(:date_time) && @current_event.start.date_time.present? %>
                  <%# For events with a specific time %>
                  <%= @current_event.start.date_time.strftime("%d %B %Y, %H:%M:%S") %> — <%= @current_event.end.date_time.strftime("%d %B %Y, %H:%M:%S") %>
                <% else %>
                  <%# For all-day events %>
                  <%= Date.parse(@current_event.start.date).strftime("%d %B %Y") %> — <%= Date.parse(@current_event.end.date).strftime("%d %B %Y") %>
                <% end %>
              </p>
              <% if @current_event.description.present? %>
                <p class="event-time">
                  <%= @current_event.description %>
                </p>
              <% end %>
            </div>
            
          <% else %>
            <%# --- NO CURRENT EVENT IS RUNNING (Show the form) --- %>            
            <h2>Focus Timer</h2>
            <div class="focus-time-container">                
              <div class="focus-time-controls js-only">
                  <input
                  type="number"
                  id="customTimerInput"
                  min="1"
                  max="240"
                  placeholder="Minutes"
                  class="focus-time-input"
                  data-timer-target="input"
                  />
              </div>
              <noscript>
                <%= form_with url: create_timer_path, method: :post, class: "focus-time-controls" do |form| %>
                  <%= form.number_field :minutes,
                                        min: 1,
                                        max: 240,
                                        placeholder: "Minutes",
                                        class: "focus-time-input",
                                        required: true %>

                  <%= form.submit "Start", class: "btn set" %>
                <% end %>
              </noscript>
              <div class="timer-controls">
                <button class="btn set js-only" data-action="click->timer#setCustom">Start</button>
                <button class="btn pause js-only" data-action="click->timer#pause" data-timer-target="pauseBtn" style="display: none;">Pause</button>
                <button class="btn reset js-only" data-action="click->timer#reset">Reset</button>
              </div>    
            </div>
          <% end %>
        <div class="timer-display" id="timerDisplay" data-timer-target="display">
            <%= @time_remaining_hms || '00:00:00' %>
          <div class="timer-controls">
            <noscript>
              <%= link_to "Refresh Timer", dashboard_path, class: "btn start" %>
            </noscript>
          </div>
        </div>
      </div>
    </main>
</div>